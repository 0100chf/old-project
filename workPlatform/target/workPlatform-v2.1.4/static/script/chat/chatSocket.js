define(["jquery","socketio","script/chat/startChat"],function(c,e,d){var a=e.connect(nodeJsUrl);var b={init:function(g,f){this.roomId=g;this.joinRoom({roomIds:g+"",userName:loginUserInfo.userId});this.listenPushData()},getConnectionIo:function(){return a},joinRoom:function(f){a.emit("joinRoom",f)},sendMessage:function(f){f.roomId=this.roomId;f.fromUser=loginUserInfo.userId;a.emit("sendMsg",f)},disconnection:function(){a.emit("disconnect")},listenPushData:function(){a.off("broadcastMsg");a.on("broadcastMsg",function(j){var f=c("#zhcs_OA_chatWindow");var i=c("#zhcs_OA_chatWindowTop",f);if(f.length>0&&i.data("groupId")==j.roomId){if(j.recordType==2){j.content="<div><p>"+j.fileName+"<a>("+d.fileSizeUnit(j.fileSize)+")</a></p></div><button class='btn btn-xs btn-success'>下载</button>"}var h;var g;var o;if(j.toUser){o=c("#chatWindow_right1"+j.roomId);g=c("#chatWindow_left0"+j.roomId+j.fromUser);if(g.length>0){if(g.hasClass("current")){}else{var m=g.find("span.badge").text();var k=m?m:0;g.find("span.badge").text(parseInt(k)+1)}}else{var n=o.find("li.friends-item[data-id='"+j.fromUser+"']");var m=n.find("span.badge").text();var k=m?m:0;n.find("span.badge").text(parseInt(k)+1);f.find("#zhcs_OA_chatWindowContent").append(d.createChatWindowContent("0",j.fromUser,j,j.roomId))}h=f.find("ul#chatWindow_content"+0+j.roomId+d.mergeId(j.fromUser,loginUserInfo.userId))}else{g=c("#chatWindow_left1"+j.roomId+j.roomId);if(g.length>0){if(g.hasClass("current")){}else{var m=g.find("span.badge").text();var k=m?m:0;g.find("span.badge").text(parseInt(k)+1)}h=f.find("ul#chatWindow_content"+1+j.roomId)}else{return false}}var l;if(j.fromUser==loginUserInfo.userId){l=c(d.createChatMessageHtml(j.recordType,true,j.fromTime,j.content,j.fromUser)).appendTo(h)}else{l=c(d.createChatMessageHtml(j.recordType,false,j.fromTime,j.content,j.fromUser)).appendTo(h)}h.animate({scrollTop:h[0].scrollHeight},300);if(j.fileUrl!=""){l.find("button.btn-success").data("url",j.fileUrl).data("name",j.fileName)}}})}};return b});