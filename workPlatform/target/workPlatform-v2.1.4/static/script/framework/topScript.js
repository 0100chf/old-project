define(["jquery","layer"],function(d){var c={indexUrl:context+"/project/home.htm",init:function(){this.setEvent();this.userInfo=a.init();this.createObject=b.init()},setEvent:function(){var e=this;d("#logoPic").on("click",function(){location.href=e.indexUrl});d(document).on("click",function(f){layer.closeAll()});d(document).on("click","div.xubox_shade",function(){return false});d(document).on("click","div.xubox_layer[type='dialog']",function(){return false})},openPersonSettingLayer:function(){var e=d("<div></div>");e.load(context+"/personal/getPersonalSetting.htm",function(){layer.closeAll();d.layer({type:1,title:false,area:["auto","500px"],border:[0],shade:[0.8,"#000"],closeBtn:[0,false],shift:["top",500,true],offset:["10px",""],page:{html:e.html()},success:function(f){d(f).on("click",function(g){EventUtil.stopPropagation(g)});d(f).on("click",".icon-cancel-circled",function(){layer.closeAll()})}})})}};var b={init:function(){this.openCreateLayerEvent()},dom:d("#createObj"),createLayerIndex:"",getLayerHtml:function(){var f=TEXT_CONFIG.global_edition.toLowerCase();var e="<div class='layer-lg boardBackground floatLayer '><ul><li id='createProject'><h6>创建"+TEXT_CONFIG.xiangmu+"</h6><p>每个"+TEXT_CONFIG.xiangmu+"都有任务板、文件库和日程表等功能。</p></li>";if(f=="web"){e+="<li id='createOrganization'  class='border-line'><h6>创建"+TEXT_CONFIG.zuzhi+"</h6><p>"+TEXT_CONFIG.zuzhi+"是"+TEXT_CONFIG.xiangmu+"和人的集合，可以用来管理你的公司、"+TEXT_CONFIG.tuandui+"。</p></li>"}e+="</ul></div>";return e},layerResize:function(e){var f=this;d(window).resize(function(){var g=f.layerPosition();d(e).css({top:g.top,left:g.left})})},layerPosition:function(){var f=this.dom.offset();var g=f.top+this.dom.height()-d(window).scrollTop()+10+"px";var e=f.left-40+"px";return{top:g,left:e}},openCreateLayerEvent:function(){var e=this;e.dom.on("click",function(g){layer.closeAll();var f=e.layerPosition();e.createLayerIndex=d.layer({type:1,title:false,area:["auto","auto"],offset:[f.top,(f.left.replace("px","")-20)+"px"],border:[0],shade:[0,"#FFFFFF"],closeBtn:[0],page:{html:e.getLayerHtml()},success:function(h){e.layerResize(h);e.openCreateProjectLayerEvent(h);e.openCreateOrganLayerEvent(h);document.documentElement.style.overflow="hidden"},end:function(h){document.documentElement.style.overflow=""}});return false})},openCreateOrganLayerEvent:function(e){var f;d(e).on("click","#createOrganization",function(){layer.closeAll();var g=d("<div></div>");g.load(context+"/org/add.htm",function(){f=d.layer({type:1,title:false,area:["auto","auto"],border:[0],shade:[0.8,"#000"],closeBtn:[0,false],shift:["top",500,true],page:{html:g.html()},success:function(h){d(h).click(function(){return false})}})})})},openCreateProjectLayerEvent:function(e){var f;d(e).on("click",function(g){EventUtil.stopPropagation(g)});d(e).on("click","#createProject",function(){layer.closeAll();var g=d("#addProjectBootstrapLayer");g.load(context+"/project/addProject.htm",function(){g.modal("show")});return false})}};var a={url:"",init:function(){this.openPersonaInfoLayerEvent()},dom:d("#personaInfo"),personaInfoIndex:"",layerResize:function(e){var f=this;d(window).resize(function(){var g=f.layerPosition();d(e).css({top:g.top,left:g.left})})},layerPosition:function(){var f=this.dom.offset();var g=f.top+this.dom.height()-d(window).scrollTop()+10+"px";var e=f.left-60+"px";return{top:g,left:e}},getLayerHtml:function(){return"<div class='layer-sm boardBackground floatLayer'><ul><li id='myTask'><a>我的任务</a></li><li id='userWeekReport'><a>我的周报</a></li><li id='personSetting'><a>个人设置</a></li><li id='loginout' class='border-line'><a>退出登录</a></li></ul></div>"},getUserInfo:{},setEvent:function(e){d(e).on("click","#myTask",function(){var f=d("div[data-id='relatedMeTempalte']");if(f.length==0){location.href=context+"/personal/personalTask.htm"}else{if(f.attr("data-moudleName")=="task"||f.find("#relateMeTaskMenu").hasClass("active")){layer.closeAll();return false}else{location.href=context+"/personal/personalTask.htm"}}});d(e).on("click","#loginout",function(){location.href=context+"/login/loginout.htm"});d(e).on("click","#userWeekReport",function(){var f=d("div[data-id='relatedMeTempalte']");if(f.length==0){location.href=context+"/personal/weeklyReport.htm"}else{if(f.attr("data-moudleName")=="report"||f.find("#relateMeWeeklyReportMenu").hasClass("active")){layer.closeAll();return false}else{location.href=context+"/personal/weeklyReport.htm"}}})},openPersonaInfoLayerEvent:function(){var e=this;e.dom.on("click",function(g){layer.closeAll();var f=e.layerPosition();e.personaInfoIndex=d.layer({type:1,title:false,area:["auto","auto"],offset:[f.top,f.left],border:[0],closeBtn:[0],fix:true,shade:[0,"#FFFFFF"],page:{html:e.getLayerHtml()},success:function(h){e.setEvent(h);e.layerResize(h);e.openPersonaSettingLayerEvent(h)}});return false})},openPersonaSettingLayerEvent:function(e){d(e).on("click",function(f){return false});d(e).on("click","#personSetting",function(){c.openPersonSettingLayer();return false})}};return c});