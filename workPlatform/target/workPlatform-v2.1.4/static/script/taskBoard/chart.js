define(["jquery","highcharts"],function(c){var a=c("div.main-content[data-id='projectTemplate']");var b={init:function(){this.projectChartContainer=c(".project-chart",a);this.getData(0);this.setEvent()},setEvent:function(){var d=this;a.on("click","#refreshTaskStatistics",function(){d.getData(3)});a.on("click","#refreshWeekTaskChart",function(){d.getData(4)});a.on("click","#refreshCountdownStatistics",function(){d.getData(5)})},getData:function(e){var d=this;c.ajax({type:"post",url:context+"/project/findProjectStatistics.htm",data:{projectId:a.data("projectId"),loadType:e}}).done(function(f){if(f&&f.success&&f.resultData){var g=f.resultData;switch(e){case 0:d.setCountdownValue(g);d.setUserNumValue(g);d.setTaskStatisticsValue(g);d.setWeekTaskChartValue(g);break;case 3:d.setTaskStatisticsValue(g);break;case 4:d.setWeekTaskChartValue(g);break;case 5:d.setCountdownValue(g);break}}else{layer.msg(f.errormsg)}}).fail(function(){layer.msg("请求失败")})},setCountdownValue:function(d){if(d.days!=null){if(d.days>0){this.projectChartContainer.find("#projectCountdown").html("还有<span>"+d.days+"</span>天")}else{if(d.days==0){this.projectChartContainer.find("#projectCountdown").text("今天结束")}else{this.projectChartContainer.find("#projectCountdown").html("逾期<span class='red'>"+d.days*-1+"</span>天")}}}else{}if(d.planDay!=null){this.projectChartContainer.find("#planDay").html(d.planDay+"天")}if(d.realityday!=null){this.projectChartContainer.find("#realityDay").html(d.realityday+"天")}},setUserNumValue:function(e){var d=0;c.each(window.projectUserList,function(){d++});if(e.teams>0){this.projectChartContainer.find("#projectUserNum").html(e.teams+"个"+TEXT_CONFIG.tuandui+"</br>共计<span>"+d+"</span>人")}else{this.projectChartContainer.find("#projectUserNum").html("共计<span>"+d+"</span>人")}},organizeTaskStatisticsData:function(e){var f=[];var d=["#058DC7","#99CC66","#CCFF66","#ffff00","#ff0000","#ff00ff"];f[0]={y:e.taskCount,color:d[0]};f[1]={y:e.doneTaskCount,color:d[1]};f[2]={y:e.doingTaskCount,color:d[2]};f[3]={y:e.tocheckTaskCount,color:d[3]};f[4]={y:e.noPassTaskAccount,color:d[4]};f[5]={y:e.tardyTaskCount,color:d[5]};return f},setTaskStatisticsValue:function(g){var f=g.taskStatistics;var d=[];if(f){d=this.organizeTaskStatisticsData(f)}var e=["总数","已完成","进行中","待审核","不通过","逾期"];this.taskStatistics=new Highcharts.Chart({chart:{renderTo:"taskStatistics",type:"column"},title:{text:"任务统计",style:{"font-size":"16px",color:"#333",margin:"10px 4px","font-weight":"600"}},xAxis:{categories:e},yAxis:{title:{text:""}},tooltip:{formatter:function(){var h="";if(f.taskCount==0){h="<b>"+this.x+": "+this.y}else{if(e[0]==this.x){h="<b>"+this.x+": "+this.y}else{if(e[1]==this.x){h="<b>"+this.x+": "+this.y+"个,占"+(100-parseInt((f.taskCount-this.y)/f.taskCount*100))+"%"}else{h="<b>"+this.x+": "+this.y+"个,占"+parseInt(this.y/f.taskCount*100)+"%"}}}return h}},legend:{enabled:false},series:[{data:d}]})},setWeekTaskChartValue:function(h){var f=h.weekStatistics;var d=["周一","周二","周三","周四","周五","周六","周日"];c("#weekTaskChart").empty();var i=[0,0,0,0,0,0,0];var g=[0,0,0,0,0,0,0];if(f){if(f.dayOfWeek==1){d[0]="今天"}else{d[f.dayOfWeek-1]="今天"}c.each(f.noTaskCount,function(j,k){if(j==1){i[6]=k}else{i[j-2]=k}});c.each(f.doneTaskCount,function(j,k){if(j==1){g[6]=k}else{g[j-2]=k}})}var e=new Highcharts.Chart({chart:{renderTo:"weekTaskChart",type:"column"},title:{text:"本周进度",style:{"font-size":"16px",color:"#333",margin:"10px 4px","font-weight":"600"}},xAxis:{categories:d},yAxis:{title:{text:""}},tooltip:{formatter:function(){var k="";var j=this.point.stackTotal;if(this.x=="今天"){if(j>0){if(this.series.name=="待完成"){k="<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"个,占"+(100-parseInt((j-this.y)/j*100))+"%"}else{k="<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"个,占"+parseInt(this.y/j*100)+"%"}}else{k="<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"个"}}else{k="<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"个"}return k}},plotOptions:{column:{stacking:"normal"}},legend:{align:"right",x:-10,verticalAlign:"top",y:20,floating:true,backgroundColor:(Highcharts.theme&&Highcharts.theme.legendBackgroundColorSolid)||"white",borderColor:"#CCC",borderWidth:1,shadow:false},series:[{color:"#6AF9C4",name:"待完成",data:i},{color:"#FFF263",name:"已完成",data:g}]})}};return b});