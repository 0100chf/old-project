require(["jquery","layer"],function(){var a={panel:$("#orgSetting")};a.pic=function(){$("#pic").click(function(){$("#input_pic_upload").click();$("#input_pic_upload").change(function(e){var g=$(this);var d=this.files;if(d.length!=0){var c=d[0],b=new FileReader();if(!b){layer.alert("该浏览器不支持头像上传");return}var f=new RegExp("image/(png|jpeg|jpg|gif|)","g");if(!f.test(c.type)){layer.alert("请选择正确格式的图片");g.after(g.clone(true).val(""));g.remove();return}if(c.limitSize("1","MB")){g.after(g.clone(true).val(""));g.remove();layer.alert("头像太大，应1MB以内");return}b.onload=function(h){var i=EventUtil.getTarget(h);$("#pic").prop("src",i.result)};b.readAsDataURL(c)}});return false})};a.init=function(){var d=this;var h=$("#pic").attr("src");$(".icon-pencil").click(function(){if(!$(this).hasClass("selected")){a.pic();$("#inputName").removeAttr("disabled");$("#inputContacter").removeAttr("disabled");$("#inputPhone").removeAttr("disabled");$("#inputDescription").removeAttr("disabled");$("#OrgBtn").removeAttr("disabled");$(this).addClass("selected");$("#input_pic_upload").attr("src",$("#pic").attr("src"))}else{$("#pic").unbind("click");$("#inputContacter").attr("disabled",true);$("#inputPhone").attr("disabled",true);$("#inputName").attr("disabled",true);$("#inputDescription").attr("disabled",true);$("#OrgBtn").attr("disabled",true);$(this).removeClass("selected");$("#pic").attr("src",h);$("#input_pic_upload").attr("src",$("#pic").attr("src"))}});$("#exit").click(function(){if(confirm("确定要退出该"+TEXT_CONFIG.zuzhi+"吗")){$.ajax({url:context+"/org/exit.htm",data:{orgId:$("#id").val()},type:"post",success:function(i){if(i&&i.success){window.location=context+"/project/home.htm"}else{if(result&&!result.success&&result.errormsg){layer.alert(result.errormsg)}else{layer.alert("请求失败",1)}}}})}});d.panel.on("click","#deleteOrg",function(){$.ajax({url:context+"/org/deleteOrg.htm",data:{orgId:$("#id").val()},type:"post",success:function(i){if(i&&i.success){window.location=context+"/project/home.htm"}else{if(result&&!result.success&&result.errormsg){layer.alert(result.errormsg)}else{layer.alert("请求失败",1)}}}})});var e=$("#inputName");var g=$("#inputDescription");var b=$("#inputPhone");var f=$("#inputContacter");var c={valiName:new InputValidate(e,true,30,0,"",null),valiDes:new InputValidate(g,false,500,0,"",null),valiPhone:new InputValidate(b,true,15,0,"",null),valiContactor:new InputValidate(f,true,30,0,"",null)};$("#OrgBtn").click(function(){var i=$(this).closest("form");var j=new FormData(i[0]);$.ajax({type:"post",url:context+"/org/modify.htm",data:j,contentType:false,processData:false,beforeSend:function(){var k=false;$.each(c,function(l,m){if(!m.checkValidate()){k=true;return false}});if(k){$(this).prop("disabled",false);return false}return true},success:function(k){if(k&&k.success){$("div.organize-logo").find("h4").html(k.resultData.name);$("div.organize-logo").find("img").attr("src",k.resultData.logo);$("#inputName").val(k.resultData.name);$("#inputDescription").val(k.resultData.description);$("#inputPhone").val(k.resultData.phone);$("#inputContacter").val(k.resultData.contacter);$("#pic").unbind("click");$("#inputPhone").attr("disabled",true);$("#inputContacter").attr("disabled",true);$("#inputName").attr("disabled",true);$("#inputDescription").attr("disabled",true);$("#OrgBtn").attr("disabled",true);$(this).removeClass("selected");$("#input_pic_upload").attr("src",$("#pic").attr("src"))}else{if(result&&!result.success&&result.errormsg){layer.alert(result.errormsg)}else{layer.alert("请求失败",1)}}}});return false})};a.init()});