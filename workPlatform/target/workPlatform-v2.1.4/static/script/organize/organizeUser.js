require(["jquery","layer"],function(){var a={};var b=$("#organize-wrap-left");b.find("div[data-user-id="+loginUserInfo.userId+"]").find(".icon-down-open-big").hide();a.init=function(){a.options();$.ajax({url:context+"/org/getCode.htm",type:"post",data:{id:$("#id").val()},success:function(c){if(c!=""){$("#linksInvite").val(c)}if(c==""){$(".open-link").show();$(".close-link").hide()}}});$("#account").on("keydown",function(c){if(c.which==13){var d={orgId:$("#id").val(),account:$("#account").val()};$.ajax({url:context+"/org/addUserByEmail.htm",data:d,type:"post",success:function(f){if(f&&f.success){var e=f.resultData.name;if(e.length>4){e=e.substr(0,4)+"..."}$("#account").val("");var g=$(".organize-wrap-left");g.append('<div class="user-block corner-6" data-user-id='+f.resultData.userId+'><img src="'+f.resultData.logo+'" class="img-circle"  /><h4 title="'+f.resultData.name+'">'+e+'</h4><i class="icon-down-open-big"></i></div>')}else{if(f&&f.errormsg){layer.alert(f.errormsg,1)}else{layer.alert("请求失败",1)}}}})}});$("#open").click(function(){$.ajax({url:context+"/org/encrypt.htm",type:"post",data:{id:$("#id").val(),type:"open"},success:function(c){if(c&&c.success){$(".open-link").hide();$(".close-link").show();$("#linksInvite").val(c.resultData)}else{if(c&&c.errormsg){layer.alert(c.errormsg,1)}else{layer.alert("请求失败",1)}}}})});$("#close").click(function(){$.ajax({url:context+"/org/encrypt.htm",type:"post",data:{id:$("#id").val(),type:"close"},success:function(c){$(".open-link").show();$(".close-link").hide()}})})};a.options=function(){var c=$(".organize-wrap-left");c.on("click",".icon-down-open-big",function(){layer.closeAll();var d=$(this).parent();a.id=d.data("user-id");a.account=d.data("account");a.active=d.data("user-active");var g=(a.active==true)?"none;":"block;";var f=($(this).offset().top-document.body.scrollTop)+"px";var e=$(this).offset().left+"px";if(!d.children().hasClass("owner-mark")){$.layer({type:1,shade:[0],area:["auto","176px"],title:false,border:[0],closeBtn:false,offset:[f,e],fix:false,page:{html:"<div id='layerDiv'><div class='layer-lg boardBackground floatLayer'><div class='layer-title'><h5>"+TEXT_CONFIG.chengyuan+"菜单</h5><i class='icon-cancel-circled-outline'></i></div><ul><li><a id='admin'> <i class='icon-user-outline'></i>设为管理员</a></li><li><a id='setAdministrator'> <i class='icon-user-outline'></i>设为监督员</a></li><li style='display:"+g+"'><a id='resetPd'> <i class='icon-user-outline'></i>重置登录密码</a></li><li><a id='delete'> <i class='icon-trash'></i>移除出"+TEXT_CONFIG.zuzhi+"</a></li></ul></div></div>"},success:function(i){$(i).click(function(){return false});$(i).on("click",".icon-cancel-circled-outline",function(){layer.closeAll()});$(i).on("click","#admin",function(){$.ajax({url:context+"/org/setAdmin.htm",data:{orgId:$("#id").val(),userId:a.id},type:"post",success:function(k){if(k&&k.success){layer.closeAll();d.append('<a class="owner-mark " title="管理员"><i class="icon-crown"></i></a>')}else{if(k&&k.errormsg){layer.alert(k.errormsg,1)}else{layer.alert("请求失败",1)}}}})});$(i).on("click","#setAdministrator",function(){$.ajax({url:context+"/org/setAdministrator.htm",data:{orgId:$("#id").val(),userId:a.id},type:"post",success:function(k){if(k&&k.success){layer.closeAll();d.append('<a class="administrator "></a>');d.append('<a class="owner-mark " title="监督员"><i class=" icon-user-1"></i></a>')}else{if(k&&k.errormsg){layer.alert(k.errormsg,1)}else{layer.alert("请求失败",1)}}}})});$(i).on("click","#delete",function(){var k=$("#layerDiv");k.empty();k.html(h)});$(i).on("click",".icon-left-open-big",function(){var k=$("#layerDiv");k.empty();k.html(j)});$(i).on("click","#resetPd",function(){var k=Math.round(900000*Math.random()+100000);var l=hex_hmac_md5(a.account,k+"");$.ajax({url:context+"/org/resetPassword.htm",data:{userId:a.id,password:k,encryptedPassword:l},type:"post",success:function(m){if(m&&m.success){layer.alert("重置密码成功，已发送邮件到您的邮箱",1)}else{layer.alert("请求失败",1)}}})});$(i).on("click","#delUser",function(){$.ajax({url:context+"/org/delUser.htm",data:{orgId:$("#id").val(),userId:a.id},type:"post",success:function(k){if(k&&k.success){layer.closeAll();d.empty();d.remove("div")}else{if(k&&k.errormsg){layer.alert(k.errormsg,1)}else{layer.alert("请求失败",1)}}}});return false});var j="<div id='layerDiv'><div class='layer-lg boardBackground floatLayer'><div class='layer-title'><h5>"+TEXT_CONFIG.chengyuan+"菜单</h5><i class='icon-cancel-circled-outline'></i></div><ul><li><a id='admin'> <i class='icon-user-outline'></i>设为管理员</a></li><li><a id='setAdministrator'> <i class='icon-user-outline'></i>设为监督员</a></li><li style='display:"+g+"'><a id='resetPd'> <i class='icon-user-outline'></i>重置登录密码</a></li><li><a id='delete'> <i class='icon-trash'></i>移除出"+TEXT_CONFIG.zuzhi+"</a></li></ul></div></div>";var h='<div class="layer-lg boardBackground floatLayer "><div class="layer-title"><h5>移除'+TEXT_CONFIG.chengyuan+'</h5><i class=" icon-left-open-big"></i><i class="icon-cancel-circled-outline"></i></div><ul><li>确认移除该'+TEXT_CONFIG.chengyuan+'？</li><li><button id="delUser" class="btn red btn-common">确认移除</button></li></ul></div>'}})}else{if(d.find("i.icon-user-1").length>0){a.active=d.data("user-active");var g=(a.active==true)?"none;":"block;";$.layer({type:1,shade:[0],area:["auto","auto"],title:false,border:[0],closeBtn:false,offset:[f,e],fix:false,page:{html:"<div id='layerDiv'><div class='layer-lg boardBackground floatLayer'><div class='layer-title'><h5>"+TEXT_CONFIG.chengyuan+"菜单</h5><i class='icon-cancel-circled-outline'></i></div><ul><li style='display:"+g+"'><a id='resetPd'> <i class='icon-user-outline'></i>重置登录密码</a></li><li><a id='cancelSuperviser'> <i class='icon-user-outline'></i>取消监督员</a></li></ul></div></div>"},success:function(h){$(h).click(function(){return false});$(h).on("click",".icon-cancel-circled-outline",function(){layer.closeAll()});$(h).on("click","#cancelSuperviser",function(){$.ajax({url:context+"/org/removeAdministrator.htm",data:{orgId:$("#id").val(),userId:a.id},type:"post",success:function(i){if(i&&i.success){layer.closeAll();d.find("a").remove()}else{if(i&&i.errormsg){layer.alert(i.errormsg,1)}else{layer.alert("请求失败",1)}}}})})}})}else{a.active=d.data("user-active");var g=(a.active==true)?"none;":"block;";$.layer({type:1,shade:[0],area:["auto","auto"],title:false,border:[0],closeBtn:false,offset:[f,e],fix:false,page:{html:"<div id='layerDiv'><div class='layer-lg boardBackground floatLayer'><div class='layer-title'><h5>"+TEXT_CONFIG.chengyuan+"菜单</h5><i class='icon-cancel-circled-outline'></i></div><ul><li style='display:"+g+"'><a id='resetPd'> <i class='icon-user-outline'></i>重置登录密码</a></li><li><a id='cancel'> <i class='icon-user-outline'></i>取消管理员</a></li></ul></div></div>"},success:function(h){$(h).click(function(){return false});$(h).on("click",".icon-cancel-circled-outline",function(){layer.closeAll()});$(h).on("click","#cancel",function(){$.ajax({url:context+"/org/cancelAdmin.htm",data:{orgId:$("#id").val(),userId:a.id},type:"post",success:function(i){if(i&&i.success){layer.closeAll();d.find("a").empty();d.find("a").remove()}else{if(i&&i.errormsg){layer.alert(i.errormsg,1)}else{layer.alert("请求失败",1)}}}})})}})}}return false})};a.init()});