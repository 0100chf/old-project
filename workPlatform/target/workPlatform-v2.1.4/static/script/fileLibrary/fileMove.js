define(["jquery","script/common/dialogAlert","jqueryZtree","layer"],function(b,c){var a={init:function(g,e,f,d,h){this.panel=g;this.projectId=f;this.folderId=e;this.callback=h;this.parentFolerId=d;this.setEvent();this.viewInit()},setEvent:function(){var d=this;d.panel.on("click","button.btn_submit",function(){var f=b(this),g=d.fileTree;f.prop("disabled",true);var e=g.getSelectedNodes();if(!e||e.length!=1){c.alert("移动目录选择错误");f.prop("disabled",false);return}b.ajax({type:"post",url:context+"/filelibrary/movefile.htm",data:{fId:d.folderId,pId:e[0].id}}).done(function(h){if(h&&h.success){layer.alert("文件移动成功",1,"信息",function(i){d.callback(e[0].id);layer.close(i)})}else{if(h&&!h.success&&h.errormsg){layer.alert(h.errormsg,1)}else{layer.alert("请求失败",1)}}}).fail(function(){layer.alert("请求失败",1)});return false})},viewInit:function(){var d=this;b.ajax({type:"post",url:context+"/filelibrary/listfolders.htm",data:{projectId:d.projectId,parentFolerId:d.parentFolerId}}).done(function(e){if(e&&e.success){d.refreshFoldersTree(e.resultData)}else{if(e&&!e.success&&e.errormsg){layer.alert(e.errormsg,1)}else{layer.alert("请求失败",1)}}}).fail(function(){layer.alert("请求失败",1)})},refreshFoldersTree:function(d){var e=this;if(!d){return}var f={data:{simpleData:{enable:true,rootPid:null}},view:{selectedMulti:false}};b.each(d,function(g,h){if(h.id==58){h.open=true}});e.fileTree=b.fn.zTree.init(e.panel.find(".folder_tree_div"),f,d)}};return a});