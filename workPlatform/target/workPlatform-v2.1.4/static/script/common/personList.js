define(["jquery","jqueryUI","layer"],function(){var a={};var b={init:function(c){var d={searchInput:false,data:{},everyone:false,claiming:false,selectData:[],dom:"",container:"",isClose:false,eventType:""};a=$.extend(d,c||{});this.createLayer()},createLayer:function(){var e=this;if(!a.dom||!a.container){return}else{var c=a.dom.offset();var f=c.top+a.dom.height()-$(window).scrollTop()+10+"px";var d=c.left+"px";$("div#selectUserLayer").closest(".xubox_layer").remove();$.layer({type:1,title:false,area:["auto","auto"],zIndex:7000,offset:[f,d],shade:[0],border:[0],closeBtn:[0],page:{html:e.createLayerHtml()},success:function(g){e.layerEvent(g);e.settingPosition(g);document.documentElement.style.overflow="hidden"},end:function(g){document.documentElement.style.overflow=""}})}},settingPosition:function(c){var g=$(window).height(),e=$(window).width(),h=$(a.dom).offset(),f=c.height(),d=c.width();if(f>g-h.top){$(c).css("top",h.top-f-$(window).scrollTop())}if(e-h.left<d){$(c).css("left",h.left-d-$(window).scrollLeft())}},layerEvent:function(c){$(c).on("click",function(){return false});if(a.isClose){$(c).find("li").on("click",function(e){var f=$(this).data("id");var d=$(this);if(a.eventType==""){$(a.container).html("<a><img data-id='"+f+"' src='"+d.find("img").attr("src")+"' class='img-circle'>"+d.text()+"</a>");layer.close(layer.index)}else{a.dom.trigger(a.eventType,[{isSelect:true,ids:[f],callback:function(){$(a.container).html("<a><img data-id='"+f+"' src='"+d.find("img").attr("src")+"' class='img-circle little-pic'>"+d.text()+"</a>");layer.close(layer.index)}}])}return false})}else{$(c).find("li").on("click",function(g){var e=$(this);if($(this).hasClass("allUsers")){$(a.container).prevAll().remove();var h="";var f=[];$.each(a.data,function(i,j){if(j.userEnabled){f.push(j.userId);h+="<li data-id='"+j.userId+"' title='"+j.name+"'><img src='"+j.logo+"'  class='img-circle'><a class='remove-member-handler'>×</a></li>"}});if(a.eventType==""){$(a.container).closest("ul").prepend(h);layer.close(layer.index)}else{a.dom.trigger(a.eventType,[{isSelect:true,ids:f,callback:function(){$(a.container).closest("ul").prepend(h);layer.close(layer.index)}}])}}else{var d=false;if($(this).find("i.icon-ok").is(":hidden")){d=true}else{d=false}if(a.eventType==""){if(d){$(this).find("i.icon-ok").show();$(a.container).before("<li data-id='"+$(this).data("id")+"'  title='"+$(this).text()+"'><img src='"+$(this).find("img").attr("src")+"' class='img-circle'><a class='remove-member-handler'>×</a></li>")}else{$(a.container).closest("ul").find("li[data-id='"+$(this).data("id")+"']").remove();$(this).find("i.icon-ok").hide()}}else{a.dom.trigger(a.eventType,[{isSelect:d,ids:[e.data("id")],callback:function(){if(d){e.find("i.icon-ok").show();$(a.container).before("<li data-id='"+e.data("id")+"'  title='"+e.text()+"'><img src='"+e.find("img").attr("src")+"' class='img-circle'><a class='remove-member-handler'>×</a></li>")}else{$(a.container).closest("ul").find("li[data-id='"+e.data("id")+"']").remove();e.find("i.icon-ok").hide()}}}])}}return false})}if(a.searchInput){$(c).on("change paste keyup","input",function(){var d=$(this).val();if(d==""){$(c).find("li").show()}else{$(c).find("li").hide();$(c).find("li:contains('"+d+"')").show()}})}},createLayerHtml:function(){var c="<div id='selectUserLayer' class='layer-sm-noscroll boardBackground floatLayer little-portrait'>";if(a.searchInput){c+="<div class='menu-input'><input class=' form-control' type='text' data-type='name'></div>"}c+="<ul class='vertical-scroll-min scroll-area'>";if(a.everyone){c+="<li data-id='-1' class='allUsers'><i class='icon-users-1'></i>所有"+TEXT_CONFIG.chengyuan+"</li>"}if(a.claiming){if($.inArray("0",a.selectData)>=0){c+="<li data-id='0' class='noUser'><img src='/workPlatform/static/images/pic-shelters.png' class='img-circle' >待认领<i class='icon-ok'></i></li>"}else{c+="<li data-id='0' class='noUser'><img src='/workPlatform/static/images/pic-shelters.png' class='img-circle' >待认领<i class='icon-ok' style='display: none;'></i></li>"}}if(!a.data||a.data.length<1){}else{if(a.data){if(a.selectData.length>0){$.each(a.data,function(d,e){var f=e.userId+"";if(e.userEnabled){if($.inArray(f,a.selectData)>=0){c+="<li data-id='"+f+"'><img src='"+e.logo+"' class='img-circle' > "+e.name+"<i class='icon-ok'></i></li>"}else{c+="<li data-id='"+f+"'><img src='"+e.logo+"' class='img-circle' > "+e.name+"<i class='icon-ok' style='display: none;'></i></li>"}}})}else{$.each(a.data,function(d,e){if(e.userEnabled){var f=e.userId+"";c+="<li data-id='"+f+"'><img src='"+e.logo+"' class='img-circle' '> "+e.name+"<i class='icon-ok' style='display: none'></i></li>"}})}}}c+="</ul></div>";return c}};return b});