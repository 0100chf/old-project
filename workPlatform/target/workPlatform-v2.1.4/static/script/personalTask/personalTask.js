require(["jquery",context+"/static/script/taskBoard/installHtml.js?_T="+(new Date()).valueOf()],function(e,h){var b=e("div[data-id='personalTemplate']");var f=e("#personalMenu",b);var a=e("#personalTaskContainer",b);var g="00101";var k=e("#completeCode").val();var j=e("#doingCode").val();var d=e("#toCheckCode").val();var c=e("#noPassCode").val();var i={init:function(){this.todayTask=e("#todayTaskList",b);this.futureTask=e("#futureTaskList",b);this.setEvent();f.find("#myAllTask").trigger("click")},getMyAllTask:function(m){var l=this;e.ajax({type:"post",url:context+"/personal/findAllProjectTask.htm",data:{roleType:m}}).done(function(n){if(n&&n.success&&n.resultData){if(n.resultData.todayProjects.length>0){l.todayTask.empty().append(l.projectList(n.resultData.todayProjects))}else{l.todayTask.empty().append('<div class="none-content"><i class="icon-tasks"></i><br /><a>目前还没有任务</a></div>')}if(n.resultData.futureProjects.length>0){l.futureTask.empty().append(l.projectList(n.resultData.futureProjects))}else{l.futureTask.empty().append('<div class="none-content"><i class="icon-tasks"></i><br /><a>目前还没有任务</a></div>')}}else{layer.msg(n.errormsg)}f.prop("disabled",false)}).fail(function(){layer.msg("请求失败");f.prop("disabled",false)})},projectList:function(m){var l=this;var n="";e.each(m,function(o,p){n+=l.createModel(p)});return n},createModel:function(l){var m="";m+="<div class='task-project' data-id='"+l.projectId+"'>";m+="<h4><i class='icon-tasks-1'></i>"+l.name+"</h4>";m+="<ul>";e.each(l.tasks,function(n,o){m+=h.myTaskHtml(o)});m+="</ul>";m+="</div>";return m},setEvent:function(){var l=this;f.on("click","#myAllTask",function(){if(e(this).hasClass("active")){return}f.prop("disabled",true);e(this).addClass("active").siblings().removeClass("active");l.getMyAllTask(4)});f.on("click","#myAssignlTask",function(){if(e(this).hasClass("active")){return}f.prop("disabled",true);e(this).addClass("active").siblings().removeClass("active");l.getMyAllTask(3)});f.on("click","#myExecuteTask",function(){if(e(this).hasClass("active")){return}f.prop("disabled",true);e(this).addClass("active").siblings().removeClass("active");l.getMyAllTask(1)});f.on("click","#myParticipateTask",function(){if(e(this).hasClass("active")){return}f.prop("disabled",true);e(this).addClass("active").siblings().removeClass("active");l.getMyAllTask(2)});a.on("click","li",function(){h.openTaskInfo(e(this));l.updateTaskEvent(e(this))})},refreshTask:function(m){var l=m.closest("div.task-project");if(l.find("li").length<=1){if(l.closest("div.taskList").children("div.task-project").length<=1){l.closest("div.taskList").html('<div class="none-content"><i class="icon-tasks"></i><br /><a>目前还没有任务</a></div>')}else{l.remove()}}else{m.remove()}},updateTaskEvent:function(m){var l=this;m.off("deleteEvent").on("deleteEvent",function(){l.refreshTask(m)});m.off("taskCheckBoxSelectEvent").on("taskCheckBoxSelectEvent",function(o,p){var n=a.find("li[data-id='"+p.taskId+"']");if(p.select){n.find("i").show()}else{n.find("i").hide()}});m.off("taskContentEvent").on("taskContentEvent",function(n,o){m.find("p").text(o.content)});m.off("taskStatusEvent").on("taskStatusEvent",function(n,o){if(o.status==d){m.find(".taskPriority").removeClass("border-red").addClass("border-yellow").attr("title",e("#toCheckText").val())}else{if(o.status==j){m.find(".taskPriority").removeClass("border-yellow border-red").removeAttr("title")}else{if(o.status==c){m.find(".taskPriority").removeClass("border-yellow").addClass("border-red").attr("title",e("#noPassText").val())}else{if(o.status==k){m.find(".taskPriority").removeClass("border-yellow border-red").addClass("border-green").attr("title",e("#completeText").val())}}}}});m.off("taskPriorityEvent").on("taskPriorityEvent",function(n,o){if(o.priority==g){m.addClass("block-green").attr("title",e("#level1Text").val())}else{m.removeClass("block-green").removeAttr("title")}})}};i.init()});