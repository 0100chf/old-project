require(["jquery","script/common/dialogAlert","jqueryUI","jqueryForm","layer","my97"],function(b,d){var a;var c=TEXT_CONFIG.global_edition.toLowerCase();if(c=="enterprice"){b("#selectOrganization").hide();b("#myselfOpt").remove()}a={init:function(){this.addProjectPage=b("#addProject");this.proInfoValiArray={};this.addProject()},addProject:function(){var h=this,e=b("#addlogo",h.addProjectPage),g=b("#projectName",h.addProjectPage),i=b("#project_description",h.addProjectPage),k=b(".pull-left",h.addProjectPage),j=b("#add_project_btn",h.addProjectPage);if(!h.proInfoValiArray.name){h.proInfoValiArray.name=new InputValidate(g,true,30,0,"text",null)}else{h.proInfoValiArray.name.target.removeClass("error")}if(!h.proInfoValiArray.description){h.proInfoValiArray.description=new InputValidate(i,false,500,0,"",null)}else{h.proInfoValiArray.description.target.removeClass("error")}var f="";b(".readyimg").each(function(){b(this).click(function(){var l=b(this);f=b(this).attr("id");b("#imgId").val(f);k.attr("src",b(this).attr("src"));b(".readyimg").each(function(){if(b(this).hasClass("select")){b(this).removeClass("select")}l.addClass("select")})})});e.on("click",function(){b("#logoFile",h.addProjectPage).click();b("#logoFile",h.addProjectPage).change(function(o){var q=b(this);var n=this.files;if(n.length!=0){var m=n[0],l=new FileReader();if(!l){d.alert("该浏览器不支持头像上传");return}var p=new RegExp("image/(png|jpeg|jpg|gif|img|)","g");if(!p.test(m.type)){d.alert("请选择正确格式的图片");q.after(q.clone(true).val(""));q.remove();return}if(m.limitSize("65","KB")){q.after(q.clone(true).val(""));q.remove();d.alert("图片太大，应65KB以内");return}l.onload=function(r){var s=EventUtil.getTarget(r);b("#projectLogo").prop("src",s.result)};l.readAsDataURL(m)}b(".readyimg").each(function(){if(b(this).hasClass("select")){b(this).removeClass("select")}})})});j.on("click",function(){j.prop("disabled",true);var l={beforeSubmit:function(){var m=false;b.each(h.proInfoValiArray,function(n,o){if(!o.checkValidate()){m=true;return false}});if(m){j.prop("disabled",false);return false}return true},success:function(m){if(m&&m.success){window.location=context+"/project/home.htm"}else{if(m&&!m.success){layer.alert(m.errormsg,1)}else{layer.alert(m,1)}}},error:function(){layer.alert("请求失败",1)},resetForm:true};b("#addProjectForm",h.addProjectPage).ajaxSubmit(l);return false})}};a.init()});